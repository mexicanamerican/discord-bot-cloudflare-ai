version: "3.9"

services:
  discord-bot-cloudflare-ai:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: discord-bot-cloudflare-ai
    restart: unless-stopped
    
    # Wrangler dev listens here
    ports:
      - "8787:8787"
    
    # Mount .dev.vars file for secrets
    volumes:
      - ./.dev.vars:/app/.dev.vars:ro
      - ./node_modules:/app/node_modules
      - ./.wrangler:/app/.wrangler
    
    environment:
      NODE_ENV: development
    
    command: >
      sh -c "
        npm ci --silent || true &&
        npx wrangler dev
        --local
        --ip 0.0.0.0
        --port 8787
        --persist-to /app/.wrangler
      "
